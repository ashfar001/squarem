{% load invoice_filters %}
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>{% if invoice.is_quotation %}Quotation{% else %}Invoice{% endif %} {{ invoice.invoice_number }}</title>
    <style>
        @page {
            size: A4;
            margin: 8mm;
            @frame watermark {
                -pdf-frame-content: watermark-content;
                top: 200px;
                left: 100px;
                width: 400px;
                height: 400px;
            }
        }
        body {
            font-family: Helvetica, Arial, sans-serif;
            color: #333;
            background: #fff;
            margin: 0;
            padding: 15px;
            font-size: 11px;
        }
        
        /* Watermark */
        #watermark-content { opacity: 0.06; }
        #watermark-content img { width: 350px; height: 350px; }
        .container { padding: 12px 18px; position: relative; z-index: 1; }
        .header-table { width: 100%; margin-bottom: 12px; }
        .header-table td { vertical-align: middle; }
        .header-logo { width: 150px; height: 150px; }
        .brand { font-size: 22px; font-weight: 700; letter-spacing: 1px; }
        .title { font-size: 20px; font-weight: 700; color: #e53935; text-align: right; }
        .header {
            width: 100%;
            margin-bottom: 10px;
        }
        .header td {
            vertical-align: top;
        }
        .company-brand {
            font-size: 24px;
            font-weight: bold;
            letter-spacing: 2px;
        }
        .invoice-title {
            font-size: 26px;
            font-weight: bold;
            color: #e53935;
            text-align: right;
        }
        
        .info-section {
            width: 100%;
            border-bottom: 1px solid #ccc;
            padding-bottom: 8px;
            margin-bottom: 10px;
        }
        .info-section td {
            vertical-align: top;
            font-size: 10px;
        }
        .info-section h6 {
            font-size: 10px;
            margin: 0 0 3px 0;
            font-weight: bold;
        }
        .info-section p {
            margin: 0;
            line-height: 1.3;
        }
        
        .meta-section {
            width: 100%;
            margin-bottom: 10px;
        }
        .meta-section td {
            width: 25%;
        }
        .meta-label {
            font-size: 9px;
            color: #666;
            font-weight: bold;
        }
        .meta-value {
            font-size: 12px;
            font-weight: bold;
        }
        .meta-value.highlight {
            color: #e53935;
        }
        
        .address-section {
            width: 100%;
            margin-bottom: 12px;
        }
        .address-section td {
            width: 50%;
            vertical-align: top;
        }
        .address-section h6 {
            font-size: 9px;
            font-weight: bold;
            margin: 0 0 3px 0;
        }
        .address-section p {
            font-size: 10px;
            margin: 0;
            line-height: 1.3;
        }
        
        .items-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 10px;
        }
        .items-table thead tr {
            border-top: 2px solid #333;
            border-bottom: 1px solid #333;
        }
        .items-table th {
            padding: 5px 3px;
            text-align: left;
            font-size: 9px;
            font-weight: bold;
        }
        .items-table th.right { text-align: right; }
        .items-table th.center { text-align: center; }
        .items-table tbody tr {
            border-bottom: 1px solid #ddd;
        }
        .items-table td {
            padding: 6px 3px;
            font-size: 10px;
        }
        .items-table td.right { text-align: right; }
        .items-table td.center { text-align: center; }
        
        .summary-section {
            width: 100%;
            margin-bottom: 12px;
        }
        .summary-left {
            width: 55%;
            vertical-align: top;
            font-size: 10px;
        }
        .summary-right {
            width: 45%;
            vertical-align: top;
        }
        .totals-table {
            width: 100%;
        }
        .totals-table td {
            padding: 3px 0;
            font-size: 10px;
        }
        .totals-table .total-row {
            border-top: 1px solid #333;
            font-weight: bold;
            font-size: 12px;
        }
        
        .signature-section {
            width: 100%;
            margin: 15px 0;
        }
        .signature-section td {
            width: 50%;
        }
        .signature-section h6 {
            font-size: 9px;
            font-weight: bold;
            margin: 0 0 3px 0;
        }
        .signature-section p {
            margin: 0;
            font-size: 10px;
        }
        
        .footer-section {
            width: 100%;
            border-top: 1px solid #ccc;
            padding-top: 10px;
        }
        .payment-info {
            vertical-align: top;
        }
        .payment-info h6 {
            font-size: 10px;
            font-weight: bold;
            margin: 0 0 5px 0;
        }
        .payment-info table {
            font-size: 9px;
        }
        .payment-info td {
            padding: 1px 5px 1px 0;
        }
        .payment-label {
            color: #e53935;
            font-weight: bold;
        }
        .qr-section {
            text-align: center;
            vertical-align: top;
            width: 130px;
        }
        .qr-section img {
            width: 80px;
            height: 80px;
        }
        .qr-section p {
            font-size: 8px;
            margin: 3px 0 0 0;
        }
    </style>
</head>
<body>
    <!-- Watermark Frame Content -->
    <!-- Header -->
<div class="container">
    <!-- Header -->
    <table class="header-table">
        <tr>
            <td style="width: 100%;">
                {% if invoice.company.logo %}
                <img src="{{ invoice.company.logo.path }}" alt="{{ invoice.company.name }}" class="header-logo">
                {% else %}
                <div class="brand">{{ invoice.company.name|upper }}</div>
                {% endif %}
            </td>
            <td style="width: 40%;">
                <div class="title">{% if invoice.is_quotation %}QUOTATION{% else %}INVOICE{% endif %}</div>
            </td>
        </tr>
    </table>
    
    <!-- Company Info -->
    <table class="info-section">
        <tr>
            <td style="width: 50%;">
                <h6>{{ invoice.company.name }}</h6>
                <p>
                    {{ invoice.company.address }}<br>
                    {% if invoice.company.city %}{{ invoice.company.city }}{% endif %}{% if invoice.company.state %}, {{ invoice.company.state }}{% endif %} - {{ invoice.company.postal_code }}<br>
                    India
                </p>
            </td>
            <td style="width: 50%; text-align: right;">
                <h6>Contact</h6>
                <p>
                    {% if invoice.company.website %}{{ invoice.company.website }}<br>{% endif %}
                    {% if invoice.company.phone %}{{ invoice.company.phone }}<br>{% endif %}
                    {% if invoice.company.email %}{{ invoice.company.email }}{% endif %}
                </p>
            </td>
        </tr>
    </table>
    
    <!-- Meta Info -->
    <table class="meta-section">
        <tr>
            <td>
                <div class="meta-label">Due Amount</div>
                <div class="meta-value highlight">Rs {{ invoice.get_balance_due|indian_currency }}/-</div>
            </td>
            <td>
                <div class="meta-label">Due Date</div>
                <div class="meta-value">{{ invoice.due_date|date:"d M, Y" }}</div>
            </td>
            <td>
                <div class="meta-label">Invoice #</div>
                <div class="meta-value">{{ invoice.invoice_number }}</div>
            </td>
            <td>
                <div class="meta-label">Invoice Date</div>
                <div class="meta-value">{{ invoice.invoice_date|date:"d M, Y" }}</div>
            </td>
        </tr>
    </table>
    
    <!-- Addresses -->
    <table class="address-section">
        <tr>
            <td>
                <h6>Invoice To</h6>
                <p>
                    <strong>{{ invoice.client.name }}</strong><br>
                    {{ invoice.client.billing_address }}<br>
                    {% if invoice.client.billing_city %}{{ invoice.client.billing_city }}{% endif %}{% if invoice.client.billing_state %}, {{ invoice.client.billing_state }}{% endif %} {{ invoice.client.billing_postal_code }}<br>
                    {{ invoice.client.billing_country|default:"" }}
                </p>
            </td>
            <td>
                <h6>Shipped To</h6>
                <p>
                    <strong>{{ invoice.client.name }}</strong><br>
                    {% if invoice.client.shipping_address %}
                    {{ invoice.client.shipping_address }}<br>
                    {% if invoice.client.shipping_city %}{{ invoice.client.shipping_city }}{% endif %}{% if invoice.client.shipping_state %}, {{ invoice.client.shipping_state }}{% endif %} {{ invoice.client.shipping_postal_code }}
                    {% else %}
                    {{ invoice.client.billing_address }}<br>
                    {% if invoice.client.billing_city %}{{ invoice.client.billing_city }}{% endif %}{% if invoice.client.billing_state %}, {{ invoice.client.billing_state }}{% endif %} {{ invoice.client.billing_postal_code }}
                    {% endif %}
                </p>
            </td>
        </tr>
    </table>
    
    <!-- Items Table -->
    <table class="items-table">
        <thead>
            <tr>
                <th style="width: 20px;">#</th>
                <th>Desc. of Goods/Services</th>
                <th class="center" style="width: 50px;">Unit</th>
                <th class="center" style="width: 45px;">Qty.</th>
                <th class="right" style="width: 65px;">Rate (Rs)</th>
                <th class="center" style="width: 35px;">Dis.</th>
                <th class="center" style="width: 35px;">GST</th>
                <th class="right" style="width: 65px;">Total (Rs)</th>
            </tr>
        </thead>
        <tbody>
            {% for item in invoice.items.all %}
            <tr>
                <td>{{ forloop.counter }}</td>
                <td>{{ item.description }}</td>
                <td class="center">{{ item.get_unit_type_display }}</td>
                <td class="center">{{ item.quantity|floatformat:2 }}</td>
                <td class="right">{{ item.rate|indian_currency }}</td>
                <td class="center">{{ item.discount|floatformat:0 }}</td>
                <td class="center">{{ item.tax_rate|floatformat:0 }}</td>
                <td class="right">{{ item.amount|indian_currency }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    
    <!-- Summary -->
    <table class="summary-section">
        <tr>
            <td class="summary-left">
                <strong>Payment Method</strong><br>
                {{ payment_info.payment_method|default:"Cash" }}<br><br>
                <strong>In Words</strong><br>
                {{ invoice.get_amount_in_words }}
            </td>
            <td class="summary-right">
                <table class="totals-table">
                    <tr>
                        <td>Sub Total</td>
                        <td style="text-align: right;">Rs {{ invoice.subtotal|indian_currency }}/-</td>
                    </tr>
                    <tr>
                        <td>GST</td>
                        <td style="text-align: right;">Rs {{ invoice.tax_amount|indian_currency }}/-</td>
                    </tr>
                    <tr class="total-row">
                        <td>Total</td>
                        <td style="text-align: right;">Rs {{ invoice.total|indian_currency }}/-</td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>
    
    <!-- Signature -->
    <table class="signature-section">
        <tr>
            <td>
                <h6>Accepted By</h6>
                <p>{{ invoice.client.name }}</p>
            </td>
            <td style="text-align: right;">
                <h6>Signature</h6>
                <p>{{ invoice.company.name }}</p>
            </td>
        </tr>
    </table>
    
    <!-- Footer -->
    <table class="footer-section">
        <tr>
            <td class="payment-info">
                <h6>Payment Info</h6>
                <table>
                    {% if invoice.company.account_number %}
                    <tr>
                        <td class="payment-label">Ac #</td>
                        <td>{{ invoice.company.account_number }}</td>
                    </tr>
                    {% endif %}
                    <tr>
                        <td class="payment-label">Ac Name</td>
                        <td>{{ invoice.company.name }}</td>
                    </tr>
                    {% if invoice.company.ifsc_code %}
                    <tr>
                        <td class="payment-label">IFSCode</td>
                        <td>{{ invoice.company.ifsc_code }}</td>
                    </tr>
                    {% endif %}
                    {% if invoice.company.bank_name %}
                    <tr>
                        <td class="payment-label">Bank</td>
                        <td>{{ invoice.company.bank_name }}{% if invoice.company.bank_branch %}, {{ invoice.company.bank_branch }}{% endif %}</td>
                    </tr>
                    {% endif %}
                </table>
            </td>
            {% if invoice.qr_code %}
            <td class="qr-section">
                <img src="{{ invoice.qr_code.path }}" alt="Payment QR">
                <p><strong>Name:</strong> {{ invoice.company.name }}<br>
                <strong>UPI:</strong> {{ invoice.company.upi_id }}</p>
            </td>
            {% endif %}
        </tr>
    </table>

</body>
</html>
